# 题目单模块接口文档

> **版本**: v1.0
> **作者**: JavierChen
> **更新时间**: 2025-12-17

## 概述

题目单(Question Set)模块允许用户创建、管理题目集合，并将题目加入到题目单中，方便批量管理和练习。

### 基础信息
- **接口前缀**: `/api/questionSet`
- **认证要求**:
  - `add`, `delete`, `edit`, `item/add`, `item/remove`: 需要登录
  - `update`, `get`, `list/page`: 仅管理员
  - `get/vo`, `list/page/vo`, `my/list/page/vo`: 公开（但需要登录才能获取完整信息）

### 数据模型

#### QuestionSet (题目单)
```json
{
  "id": 1,
  "title": "算法基础题集",
  "description": "包含基础的排序、查找算法题目",
  "tags": ["算法", "难度-简单", "排序"],
  "questionNum": 15,
  "userId": 123,
  "favourNum": 42,
  "createTime": "2025-12-17T10:00:00Z",
  "updateTime": "2025-12-17T10:00:00Z"
}
```

#### QuestionSetVO (题目单视图)
```json
{
  "id": 1,
  "title": "算法基础题集",
  "description": "包含基础的排序、查找算法题目",
  "tags": ["算法", "难度-简单", "排序"],
  "questionNum": 15,
  "userId": 123,
  "favourNum": 42,
  "createTime": "2025-12-17T10:00:00Z",
  "userVO": {
    "id": 123,
    "userName": "Javier",
    "userAvatar": "https://example.com/avatar.jpg",
    "userProfile": "算法爱好者",
    "userRole": "user",
    "createTime": "2025-01-01T00:00:00Z"
  },
  "questions": [
    {
      "id": 101,
      "title": "两数之和",
      "content": "给定一个整数数组 nums 和一个整数目标值 target，请你在该数组中找出和为目标值 target 的那两个整数...",
      "tags": ["easy", "array", "hash-table"],
      "submitNum": 1000,
      "acceptedNum": 650,
      "favourNum": 10,
      "userId": 1,
      "createTime": "2025-12-01T10:00:00Z",
      "userVO": { /* ... user info ... */ }
    }
  ]
}
```

---

## 接口列表

### 1. 创建题目单

**接口**: `POST /questionSet/add`
**权限**: 需要登录

**请求参数** (QuestionSetAddRequest):
```json
{
  "title": "算法基础题集",      // string, 题目单标题 (必填, 长度≤80)
  "description": "基础算法",   // string, 题目单描述 (选填, 长度≤1024)
  "tags": ["算法", "简单"]     // array, 标签列表 (选填, 总长度≤8192)
}
```

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": 1001  // 新创建的题目单ID
}
```

**可能错误**:
- `40001`: 题目单标题不能为空
- `40001`: 题目单标题过长 (>80)
- `40001`: 题目单描述过长 (>1024)
- `40001`: 标签过多 (>8192)

---

### 2. 删除题目单

**接口**: `POST /questionSet/delete`
**权限**: 需要登录（仅本人或管理员）

**请求参数** (DeleteRequest):
```json
{
  "id": 1001  // long, 题目单ID (必填, >0)
}
```

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": true
}
```

**可能错误**:
- `40001`: 参数错误
- `40404`: 题目单不存在
- `40303`: 无权限（不是创建者也不是管理员）

---

### 3. 更新题目单（管理员）

**接口**: `POST /questionSet/update`
**权限**: 仅管理员

**请求参数** (QuestionSetUpdateRequest):
```json
{
  "id": 1001,                // long, 题目单ID (必填)
  "title": "算法进阶题集",    // string, 题目单标题
  "description": "进阶算法",  // string, 题目单描述
  "tags": ["算法", "中等"]    // array, 标签列表
}
```

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": true
}
```

---

### 4. 编辑题目单（创建者）

**接口**: `POST /questionSet/edit`
**权限**: 需要登录（仅本人）

**请求参数** (QuestionSetEditRequest):
```json
{
  "id": 1001,                // long, 题目单ID (必填)
  "title": "算法进阶题集",    // string, 题目单标题
  "description": "进阶算法",  // string, 题目单描述
  "tags": ["算法", "中等"]    // array, 标签列表
}
```

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": true
}
```

**可能错误**:
- `40001`: 参数错误
- `40404`: 题目单不存在
- `40303`: 无权限（不是创建者）

---

### 5. 获取题目单详情（视图）

**接口**: `GET /questionSet/get/vo?id=1001`
**权限**: 公开

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | long | 是 | 题目单ID |

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "id": 1001,
    "title": "算法基础题集",
    "description": "包含基础的排序、查找算法题目",
    "tags": ["算法", "简单"],
    "questionNum": 15,
    "userId": 123,
    "favourNum": 42,
    "createTime": "2025-12-17T10:00:00Z",
    "userVO": {
      "id": 123,
      "userName": "Javier",
      "userAvatar": "https://example.com/avatar.jpg",
      "userProfile": "算法爱好者",
      "userRole": "user",
      "createTime": "2025-01-01T00:00:00Z"
    },
    "questions": [
      {
        "id": 101,
        "title": "两数之和",
        "content": "题目内容...",
        "tags": ["easy", "array"],
        "submitNum": 1000,
        "acceptedNum": 650,
        "favourNum": 10,
        "userId": 1,
        "createTime": "2025-12-01T10:00:00Z",
        "userVO": { /* 用户信息 */ }
      }
    ]
  }
}
```

---

### 6. 获取题目单详情（管理员）

**接口**: `GET /questionSet/get?id=1001`
**权限**: 仅管理员

**请求参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | long | 是 | 题目单ID |

**成功响应** (返回原始QuestionSet对象):
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "id": 1001,
    "title": "算法基础题集",
    "description": "包含基础的排序、查找算法题目",
    "tags": "[\"算法\",\"简单\"]",
    "questionNum": 15,
    "userId": 123,
    "favourNum": 42,
    "createTime": "2025-12-17T10:00:00Z",
    "updateTime": "2025-12-17T10:00:00Z",
    "isDelete": 0
  }
}
```

---

### 7. 分页查询题目单列表（管理员）

**接口**: `POST /questionSet/list/page`
**权限**: 仅管理员

**请求参数** (QuestionSetQueryRequest):
```json
{
  "current": 1,          // 当前页号, 默认1
  "pageSize": 10,        // 页面大小, 默认10, 最大20
  "id": 1001,           // 按ID精确查询
  "title": "算法",       // 模糊搜索标题
  "description": "基础", // 模糊搜索描述
  "userId": 123,        // 按创建者查询
  "sortField": "createTime",  // 排序字段
  "sortOrder": "ascend"       // 排序顺序: 'ascend'升序 或 'descend'降序
}
```

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "records": [
      {
        "id": 1001,
        "title": "算法基础题集",
        "description": "包含基础的排序、查找算法题目",
        "tags": "[\"算法\",\"简单\"]",
        "questionNum": 15,
        "userId": 123,
        "favourNum": 42,
        "createTime": "2025-12-17T10:00:00Z",
        "updateTime": "2025-12-17T10:00:00Z",
        "isDelete": 0
      }
    ],
    "total": 50,
    "size": 10,
    "current": 1,
    "orders": [],
    "hitCount": false,
    "searchCount": true,
    "pages": 5
  }
}
```

---

### 8. 分页查询题目单列表（视图 - 推荐）

**接口**: `POST /questionSet/list/page/vo`
**权限**: 公开

**请求参数** (QuestionSetQueryRequest): 同接口7

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "records": [
      {
        "id": 1001,
        "title": "算法基础题集",
        "description": "包含基础的排序、查找算法题目",
        "tags": ["算法", "简单"],
        "questionNum": 15,
        "userId": 123,
        "favourNum": 42,
        "createTime": "2025-12-17T10:00:00Z",
        "userVO": { /* 用户信息 */ },
        "questions": [ /* 题目列表 */ ]  // 只返回前N个题目作为预览
      }
    ],
    "total": 50,
    "size": 10,
    "current": 1
  }
}
```

---

### 9. 分页查询当前用户的题目单列表

**接口**: `POST /questionSet/my/list/page/vo`
**权限**: 需要登录

**请求参数** (QuestionSetQueryRequest): 同接口7（无需传userId，会自动使用当前用户）

```json
{
  "current": 1,
  "pageSize": 10,
  "title": "算法",       // 可选：按标题搜索
  "sortField": "createTime",
  "sortOrder": "descend"
}
```

**成功响应**: 同接口8

---

### 10. 向题目单添加题目

**接口**: `POST /questionSet/item/add`
**权限**: 需要登录（创建者或管理员）

**请求参数** (QuestionSetItemAddRequest):
```json
{
  "questionSetId": 1001,  // long, 题目单ID (必填)
  "questionId": 201,      // long, 题目ID (必填)
  "sortOrder": 0          // integer, 排序值(越小越前), 选填，默认0
}
```

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": true
}
```

**可能错误**:
- `40001`: 题目单id不能为空 或 题目id不能为空
- `40404`: 题目单不存在 或 题目不存在
- `40303`: 无权限（只有题目单创建者或管理员可以添加题目）
- `40002`: 题目已在题目单中

---

### 11. 从题目单移除题目

**接口**: `POST /questionSet/item/remove`
**权限**: 需要登录（创建者或管理员）

**请求参数** (QuestionSetItemRemoveRequest):
```json
{
  "questionSetId": 1001,  // long, 题目单ID (必填)
  "questionId": 201       // long, 题目ID (必填)
}
```

**成功响应**:
```json
{
  "code": 0,
  "message": "ok",
  "data": true
}
```

**可能错误**:
- `40001`: 题目单id不能为空 或 题目id不能为空
- `40404`: 题目单不存在
- `40303`: 无权限（只有题目单创建者或管理员可以移除题目）
- `40404`: 题目不在题目单中

---

## 错误码说明

| 错误码 | 说明 | 典型场景 |
|--------|------|----------|
| 40001 | 参数错误 | 参数为空、格式错误、长度超限 |
| 40404 | 资源不存在 | 题目单/题目ID不存在 |
| 40303 | 无权限 | 非本人/非管理员操作 |
| 40101 | 未登录 | 需要登录的接口未携带token |

---

## 调用示例

### JavaScript / TypeScript (Axios)

```typescript
import axios from 'axios';

const API_BASE = '/api/questionSet';

// 1. 创建题目单
const createQuestionSet = async (data: {
  title: string;
  description?: string;
  tags?: string[];
}) => {
  const resp = await axios.post(`${API_BASE}/add`, data);
  return resp.data; // 返回题目单ID
};

// 2. 添加题目到题目单
const addToSet = async (questionSetId: number, questionId: number, sortOrder?: number) => {
  await axios.post(`${API_BASE}/item/add`, {
    questionSetId,
    questionId,
    sortOrder
  });
};

// 3. 获取我的题目单列表（带题目详情）
const getMyQuestionSets = async (params = {}) => {
  const resp = await axios.post(`${API_BASE}/my/list/page/vo`, {
    current: 1,
    pageSize: 10,
    ...params
  });
  return resp.data; // 包含用户信息和题目列表
};

// 4. 查询题目单详情
const getQuestionSetDetail = async (id: number) => {
  const resp = await axios.get(`${API_BASE}/get/vo`, {
    params: { id }
  });
  return resp.data; // 完整的QuestionSetVO
};

// 5. 删除题目单
const deleteQuestionSet = async (id: number) => {
  await axios.post(`${API_BASE}/delete`, { id });
};
```

### Python (requests)

```python
import requests

API_BASE = "http://localhost:8080/api/questionSet"
HEADERS = {"Content-Type": "application/json"}

# 1. 创建题目单
def create_question_set(title, description=None, tags=None):
    data = {"title": title}
    if description:
        data["description"] = description
    if tags:
        data["tags"] = tags

    resp = requests.post(f"{API_BASE}/add", json=data, headers=HEADERS)
    return resp.json()["data"]  # 返回题目单ID

# 2. 添加题目
def add_question_to_set(set_id, question_id, sort_order=None):
    data = {
        "questionSetId": set_id,
        "questionId": question_id,
        "sortOrder": sort_order or 0
    }
    resp = requests.post(f"{API_BASE}/item/add", json=data, headers=HEADERS)
    return resp.json()["data"]

# 3. 查询用户题目单
def get_my_question_sets(page=1, size=10):
    data = {
        "current": page,
        "pageSize": size,
        "sortField": "createTime",
        "sortOrder": "descend"
    }
    resp = requests.post(f"{API_BASE}/my/list/page/vo", json=data, headers=HEADERS)
    return resp.json()["data"]

# 4. 获取题目单详情
def get_question_set_detail(set_id):
    resp = requests.get(f"{API_BASE}/get/vo", params={"id": set_id})
    return resp.json()["data"]
```

### 前端调用示例 (React + TypeScript)

```typescript
import React, { useState, useEffect } from 'react';
import axios from 'axios';

interface QuestionSet {
  id: number;
  title: string;
  description: string;
  tags: string[];
  questionNum: number;
  favourNum: number;
  createTime: string;
}

export const QuestionSetList: React.FC = () => {
  const [questionSets, setQuestionSets] = useState<QuestionSet[]>([]);

  useEffect(() => {
    loadQuestionSets();
  }, []);

  const loadQuestionSets = async () => {
    try {
      const resp = await axios.post('/api/questionSet/list/page/vo', {
        current: 1,
        pageSize: 10,
        sortField: 'createTime',
        sortOrder: 'descend'
      });
      setQuestionSets(resp.data.records);
    } catch (error) {
      console.error('加载失败:', error);
    }
  };

  const handleCreate = async () => {
    try {
      const id = await axios.post('/api/questionSet/add', {
        title: '我的题目单',
        description: '练习题',
        tags: ['练习']
      });
      alert(`创建成功，ID: ${id.data}`);
    } catch (error) {
      console.error('创建失败:', error);
    }
  };

  return (
    <div>
      <button onClick={handleCreate}>创建题目单</button>
      <ul>
        {questionSets.map(item => (
          <li key={item.id}>
            <h3>{item.title}</h3>
            <p>{item.description}</p>
            <p>题目数: {item.questionNum} | 收藏: {item.favourNum}</p>
          </li>
        ))}
      </ul>
    </div>
  );
};
```

---

## 常见问题

### Q1: 如何判断用户是否有权限操作题目单？
- **删除**、**编辑**、**添加题目**、**移除题目**：都会自动检查当前登录用户是否为创建者或管理员
- 无需前端额外判断，后端会返回错误提示

### Q2: tags字断该如何存储？
- 前端传入字符串数组，例如 `["算法", "简单", "排序"]`
- 后端自动转换为JSON字符串存储到数据库
- 查询和返回时会自动转回数组

### Q3: 为什么 list/page/vo 返回的 questions 只包含部分题目？
- 为避免大数据量问题，查询列表时仅预览前N个题目
- 获取完整题目列表请调用 `get/vo` 单个详情接口

### Q4: 搜索功能如何使用？
- `title` 和 `description` 支持模糊查询（LIKE '%关键字%')
- 如需精确搜索，可使用 `id` 或 `userId` 字段

### Q5: sortField 可以排序哪些字段？
支持：`id`, `title`, `questionNum`, `favourNum`, `createTime`, `updateTime`

---

## 更新日志

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v1.0 | 2025-12-17 | 初版接口文档 |

---

**开发联系**: JavierChen
**邮箱**: j.chen@example.com
